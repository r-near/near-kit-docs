# AI Agent Cookbook: Types & Results

This document provides detailed TypeScript definitions for the inputs and outputs of `near-kit`'s primary functions. Use this as a schema for constructing inputs and parsing results.

## `transaction.send()` Result

The `.send()` method on a `TransactionBuilder` returns a `FinalExecutionOutcomeWithReceipts` object.

```typescript
import type {
  FinalExecutionStatus,
  ExecutionOutcomeWithId,
} from "near-kit";

export type FinalExecutionOutcomeWithReceipts = {
  // The final status of the transaction.
  final_execution_status: FinalExecutionStatus; // "FINAL", "EXECUTED_OPTIMISTIC", "INCLUDED", "NONE"
  
  // The status of the transaction itself.
  status: {
    SuccessValue?: string; // Base64-encoded return value, if any
    Failure?: object;      // Error object if the transaction failed
  };

  // The transaction object that was sent.
  transaction: {
    signer_id: string;
    public_key: string;
    nonce: number;
    receiver_id: string;
    actions: object[];
    signature: string;
    hash: string;
  };

  // The outcome of the initial transaction execution.
  transaction_outcome: ExecutionOutcomeWithId;

  // The outcomes of all receipts generated by the transaction.
  receipts_outcome: ExecutionOutcomeWithId[];
};
```

### Key Properties to Check

-   `result.final_execution_status`: Use this to confirm the transaction is fully finalized.
-   `result.status.SuccessValue`: If a contract method returns a value, it will be here as a base64-encoded string. You need to decode it and then parse it (e.g., `JSON.parse(Buffer.from(successValue, 'base64').toString())`).
-   `result.status.Failure`: If the transaction failed at the protocol level, details will be here.
-   `result.receipts_outcome[...].outcome.logs`: An array of log messages from the contract. Essential for debugging.
-   `result.receipts_outcome[...].outcome.status.Failure`: If a specific action (receipt) failed, the `FunctionCallError` details will be here.

---

## `near.view()` Result

The `near.view()` method returns the parsed JSON result directly from the contract. The type is whatever the contract method returns.

```typescript
// Example: calling a method that returns an array of messages
const messages = await near.view<Array<{ sender: string; text: string }>>(
  "guestbook.testnet",
  "get_messages",
  {}
);
// `messages` is already a JavaScript array of objects.
```

If the view call fails, it will throw a `FunctionCallError`.

---

## `near.getStatus()` Result

Returns a `NodeStatusResult` object.

```typescript
export type NodeStatusResult = {
  chain_id: string;
  rpc_addr: string;
  sync_info: {
    latest_block_hash: string;
    latest_block_height: number;
    latest_state_root: string;
    latest_block_time: string;
    syncing: boolean;
  };
  validators: object[];
};
```

### Simplified `near.getStatus()`

`near-kit` provides a simplified version of this as `near.getStatus()`:

```typescript
const status = await near.getStatus();
// status = {
//   chainId: 'testnet',
//   latestBlockHeight: 123456789,
//   syncing: false
// }
```

---

## `near.getBalance()` Result

Returns a formatted string.

```typescript
const balance = await near.getBalance("alice.testnet");
// balance is a string like "100.00 NEAR"
```

If you need the raw yoctoNEAR value, use `near.getAccountDetails()`.

---

## Amount Utilities

### `Amount` Namespace

Helper functions for creating amount strings programmatically:

```typescript
import { Amount } from "near-kit";

// Constructors
Amount.NEAR(10);        // "10 NEAR"
Amount.NEAR(10.5);      // "10.5 NEAR"
Amount.NEAR("10.5");    // "10.5 NEAR"
Amount.yocto(1000000n); // "1000000 yocto"
Amount.yocto("1000000"); // "1000000 yocto"

// Constants
Amount.ZERO;      // "0 yocto"
Amount.ONE_NEAR;  // "1 NEAR"
Amount.ONE_YOCTO; // "1 yocto"
```

### `formatAmount()` Function

Converts raw yoctoNEAR to human-readable NEAR:

```typescript
import { formatAmount } from "near-kit";

// Basic usage
formatAmount("100000000000000000000000000");
// "100.00 NEAR"

// With options
formatAmount("100500000000000000000000000", {
  precision: 4,        // Number of decimal places (default: 2)
  trimZeros: true,     // Remove trailing zeros (default: false)
  includeSuffix: false // Exclude " NEAR" suffix (default: true)
});
// "100.5"
```

### `parseAmount()` Function

Converts human-readable amounts to yoctoNEAR (returns a string):

```typescript
import { parseAmount } from "near-kit";

parseAmount("10 NEAR");      // "10000000000000000000000000"
parseAmount("10.5 NEAR");    // "10500000000000000000000000"
parseAmount("1000 yocto");   // "1000"
parseAmount(1000n);          // "1000" (bigints are treated as yoctoNEAR)
```

---

## `near.getAccountDetails()` Result

Provides low-level details about an account.

```typescript
export type AccountView = {
  amount: string; // Balance in yoctoNEAR
  locked: string; // Staked balance in yoctoNEAR
  code_hash: string;
  storage_usage: number;
  storage_paid_at: number;
};

const details = await near.getAccountDetails("alice.testnet");
// details.amount will be a string like "100000000000000000000000000"

---

## `near.rpc.getAccessKey()` Result

Provides low-level details about an access key. Note that this is a method on the `rpc` object, not the main `near` object.

```typescript
export type AccessKeyView = {
  nonce: number;
  permission: "FullAccess" | {
    FunctionCall: {
      receiver_id: string;
      method_names: string[];
      allowance?: string | null;
    };
  };
  block_height: number;
  block_hash: string;
};

const key = await near.rpc.getAccessKey("alice.testnet", "ed25519:...");
// key.permission will be 'FullAccess' or an object with FunctionCall details.
```

---

## Error Types

All errors thrown by `near-kit` extend the base `NearError` class.

### `NearError`

This is the base class for all errors.

```typescript
export class NearError extends Error {
  code: string; // A stable, machine-readable error code (e.g., "NETWORK_ERROR")
  data?: unknown; // Optional additional data about the error
}
```

### `FunctionCallError`

This is the most common error, indicating that a smart contract call failed during execution.

```typescript
export class FunctionCallError extends NearError {
  code: "FUNCTION_CALL_ERROR";
  contractId: string; // The ID of the contract that failed
  methodName?: string; // The name of the method that was called
  panic?: string; // The panic message from the contract (e.g., "ERR_NOT_ENOUGH_FUNDS")
  logs: string[]; // Any logs emitted by the contract before it failed
}
```

---

## Transaction Action Types

Transactions are composed of one or more actions. Here are the structures for the most common action types. An agent can use these to construct or inspect transactions.

### `TransferAction`

```typescript
export type TransferAction = {
  transfer: {
    deposit: bigint; // Amount in yoctoNEAR
  };
};
```

### `FunctionCallAction`

```typescript
export type FunctionCallAction = {
  functionCall: {
    methodName: string;
    args: Uint8Array; // Serialized arguments
    gas: bigint; // Raw gas units
    deposit: bigint; // Attached deposit in yoctoNEAR
  };
};
```

### `CreateAccountAction`

```typescript
export type CreateAccountAction = {
  createAccount: {};
};
```

### `DeployContractAction`

```typescript
export type DeployContractAction = {
  deployContract: {
    code: Uint8Array; // Wasm bytecode of the contract
  };
};
```

### `AddKeyAction`

```typescript
import type { PublicKey, AccessKeyPermissionBorsh } from "near-kit";

export type AddKeyAction = {
  addKey: {
    publicKey: PublicKey;
    accessKey: {
      nonce: bigint;
      permission: AccessKeyPermissionBorsh;
    };
  };
};
```

### `DeleteKeyAction`

```typescript
import type { PublicKey } from "near-kit";

export type DeleteKeyAction = {
  deleteKey: {
    publicKey: PublicKey;
  };
};
```

### `DeleteAccountAction`

```typescript
export type DeleteAccountAction = {
  deleteAccount: {
    beneficiaryId: string; // Account to receive the remaining balance
  };
};
```

### `StakeAction`

```typescript
import type { PublicKey } from "near-kit";

export type StakeAction = {
  stake: {
    stake: bigint; // Amount to stake in yoctoNEAR
    publicKey: PublicKey; // Validator's public key
  };
};
```

